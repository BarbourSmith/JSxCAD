import { boot } from '@jsxcad/sys';
import { canonicalize } from '@jsxcad/geometry-tagged';
import fromSvg from './fromSvg.js';
import fs from 'fs';
import test from 'ava';

const { readFile } = fs.promises;

test.beforeEach(async (t) => {
  await boot();
});

test('Decode ship.svg', async (t) => {
  const data = await readFile('ship.svg');
  const ship = await fromSvg(data);
  t.deepEqual(canonicalize(ship), {
    type: 'assembly',
    content: [
      {
        type: 'z0Surface',
        z0Surface: [
          [
            [1076.9173, -2020.2966, 0],
            [1134.1358, -2020.5038, 0],
            [1162.7006, -2020.2839, 0],
            [1195.2994, -2017.3172, 0],
            [1260.8744, -2015.5622, 0],
            [1326.5323, -2015.3693, 0],
            [1391.769, -2011.9273, 0],
            [1424.0719, -2007.4844, 0],
            [1468.0616, -2005.5686, 0],
            [1554.2851, -1994.1379, 0],
            [1596.3234, -1984.4087, 0],
            [1612.222, -1981.547, 0],
            [1641.1867, -1968.9727, 0],
            [1665.9481, -1949.3524, 0],
            [1685.9943, -1925.1928, 0],
            [1694.0893, -1912.194, 0],
            [1708.5388, -1887.8359, 0],
            [1736.4726, -1839.1712, 0],
            [1749.6518, -1815.6211, 0],
            [1758.8508, -1788.5985, 0],
            [1779.7244, -1736.5343, 0],
            [1786.6935, -1708.2257, 0],
            [1791.3628, -1698.5933, 0],
            [1796.7334, -1677.4427, 0],
            [1798.2859, -1642.7461, 0],
            [1797.7821, -1595.8218, 0],
            [1803.4453, -1564.2014, 0],
            [1813.514, -1546.5665, 0],
            [1821.1195, -1539.1315, 0],
            [1825.1703, -1534.4069, 0],
            [1836.1593, -1529.2171, 0],
            [1856.3122, -1530.1099, 0],
            [1880.0953, -1541.9802, 0],
            [1887.336, -1554.294, 0],
            [1883.5681, -1562.1567, 0],
            [1878.3958, -1565.5899, 0],
            [1867.0126, -1566.3463, 0],
            [1853.1061, -1572.1291, 0],
            [1849.2905, -1581.6844, 0],
            [1853.4995, -1592.7072, 0],
            [1863.6667, -1602.8922, 0],
            [1877.7258, -1609.9344, 0],
            [1893.6102, -1611.5287, 0],
            [1909.2537, -1605.3699, 0],
            [1916.3393, -1598.6628, 0],
            [1924.4306, -1587.4067, 0],
            [1931.8346, -1562.7515, 0],
            [1928.2399, -1537.6568, 0],
            [1914.4936, -1515.0233, 0],
            [1904.0783, -1505.5361, 0],
            [1889.8764, -1497.2456, 0],
            [1858.2331, -1488.884, 0],
            [1824.8169, -1490.3799, 0],
            [1792.6838, -1500.4111, 0],
            [1778.0532, -1508.2142, 0],
            [1771.3837, -1514.6051, 0],
            [1761.4225, -1529.1326, 0],
            [1752.867, -1554.1929, 0],
            [1747.6173, -1590.6409, 0],
            [1741.355, -1626.2713, 0],
            [1735.0997, -1642.319, 0],
            [1729.1785, -1653.2281, 0],
            [1713.9127, -1673.4216, 0],
            [1694.6415, -1690.0299, 0],
            [1672.0365, -1701.3507, 0],
            [1659.6935, -1704.4961, 0],
            [1626.087, -1717.7697, 0],
            [1555.0441, -1737.7053, 0],
            [1519.4643, -1745.5065, 0],
            [1480.4472, -1754.8644, 0],
            [1399.5757, -1769.6895, 0],
            [1358.0904, -1772.7725, 0],
            [1331.8774, -1778.4932, 0],
            [1278.1537, -1783.8764, 0],
            [1196.1439, -1785.9061, 0],
            [1141.937, -1790.307, 0],
            [1120.3999, -1789.4177, 0],
            [1084.6122, -1791.3373, 0],
            [1073.5829, -1785.4063, 0],
            [1071.4148, -1776.2819, 0],
            [1072.3185, -1769.7401, 0],
            [1074.782, -1727.7726, 0],
            [1081.686, -1644.1538, 0],
            [1085.5477, -1602.6315, 0],
            [1133.1024, -1597.4762, 0],
            [1229.7049, -1595.0697, 0],
            [1278.0673, -1595.0453, 0],
            [1323.1707, -1599.1724, 0],
            [1413.1319, -1611.9662, 0],
            [1457.2127, -1620.404, 0],
            [1441.7988, -1601.0089, 0],
            [1410.9038, -1561.5331, 0],
            [1395.1101, -1541.9664, 0],
            [1381.2516, -1525.706, 0],
            [1356.936, -1490.3345, 0],
            [1343.3593, -1474.4657, 0],
            [1330.1101, -1451.4969, 0],
            [1302.3541, -1405.8725, 0],
            [1290.7568, -1381.9717, 0],
            [1278.556, -1362.5032, 0],
            [1261.2805, -1319.8432, 0],
            [1252.2352, -1299.6836, 0],
            [1243.2609, -1271.0768, 0],
            [1227.0999, -1213.0503, 0],
            [1221.1939, -1182.6055, 0],
            [1218.5094, -1135.7486, 0],
            [1219.2851, -1065.5965, 0],
            [1224.9103, -1019.4673, 0],
            [1229.7456, -996.7357, 0],
            [1236.4987, -971.777, 0],
            [1252.9484, -923.2004, 0],
            [1262.8185, -898.8399, 0],
            [1274.1835, -874.7689, 0],
            [1299.9985, -830.4434, 0],
            [1313.0893, -807.5586, 0],
            [1324.7362, -793.8791, 0],
            [1330.509, -782.197, 0],
            [1328.0205, -779.5895, 0],
            [1317.2873, -782.2307, 0],
            [1295.1697, -795.4245, 0],
            [1283.0197, -805.0699, 0],
            [1256.4472, -819.9343, 0],
            [1203.6355, -850.0575, 0],
            [1179.12, -866.2895, 0],
            [1171.2576, -873.3326, 0],
            [1159.6395, -879.6202, 0],
            [1138.6567, -892.6488, 0],
            [1135.6013, -858.3376, 0],
            [1134.6076, -821.4934, 0],
            [1135.0483, -803.3913, 0],
            [1127.8151, -796.9466, 0],
            [1116.6119, -796.0935, 0],
            [1109.1605, -807.8211, 0],
            [1104.7425, -827.968, 0],
            [1102.2527, -887.8629, 0],
            [1103.1323, -911.2486, 0],
            [1096.2761, -914.5716, 0],
            [1059.1021, -934.4237, 0],
            [1040.5685, -946.4648, 0],
            [1017.9351, -960.5325, 0],
            [971.1976, -988.4963, 0],
            [946.8736, -1001.3226, 0],
            [935.9119, -1009.6108, 0],
            [920.433, -1031.7074, 0],
            [904.2455, -1070.7718, 0],
            [891.0789, -1094.6315, 0],
            [874.8263, -1128.8361, 0],
            [823.6101, -1230.8919, 0],
            [791.3051, -1298.6209, 0],
            [769.7759, -1349.0817, 0],
            [748.6304, -1401.2043, 0],
            [738.9435, -1426.6836, 0],
            [732.2075, -1449.5949, 0],
            [721.1227, -1496.8184, 0],
            [715.2295, -1545.2038, 0],
            [716.9383, -1593.904, 0],
            [721.3966, -1618.1075, 0],
            [732.9172, -1638.7506, 0],
            [752.3722, -1667.9799, 0],
            [768.8308, -1683.7066, 0],
            [778.631, -1689.7728, 0],
            [784.2031, -1695.4865, 0],
            [796.1087, -1703.6475, 0],
            [815.2015, -1708.5884, 0],
            [841.0895, -1703.9703, 0],
            [864.8534, -1689.9282, 0],
            [875.0468, -1680.5265, 0],
            [897.9157, -1667.529, 0],
            [944.8282, -1644.1946, 0],
            [970.4539, -1634.3815, 0],
            [991.8287, -1628.6792, 0],
            [1040.5658, -1612.8303, 0],
            [1050.0164, -1609.5599, 0],
            [1050.1654, -1630.7052, 0],
            [1047.2399, -1709.568, 0],
            [1039.7296, -1763.5662, 0],
            [1033.4165, -1783.2763, 0],
            [1003.4653, -1785.081, 0],
            [943.7499, -1783.7264, 0],
            [854.7333, -1774.1991, 0],
            [795.8289, -1766.6732, 0],
            [764.937, -1760.6562, 0],
            [703.542, -1745.8192, 0],
            [672.7976, -1737.569, 0],
            [651.2661, -1730.1161, 0],
            [609.3445, -1711.4657, 0],
            [589.4539, -1700.5274, 0],
            [580.4206, -1697.8565, 0],
            [564.3087, -1689.6221, 0],
            [551.1285, -1678.1375, 0],
            [541.2705, -1664.1307, 0],
            [535.1253, -1648.3295, 0],
            [533.0835, -1631.4617, 0],
            [535.5355, -1614.2551, 0],
            [542.8719, -1597.4377, 0],
            [548.4939, -1589.4024, 0],
            [562.8478, -1565.3684, 0],
            [583.327, -1528.1353, 0],
            [599.5616, -1504.7028, 0],
            [609.2976, -1493.9634, 0],
            [626.7275, -1468.0647, 0],
            [653.7925, -1429.4916, 0],
            [665.197, -1400.3127, 0],
            [667.0428, -1383.7465, 0],
            [653.6604, -1388.5297, 0],
            [638.7543, -1389.624, 0],
            [632.4478, -1386.682, 0],
            [628.7528, -1377.417, 0],
            [635.2564, -1357.3824, 0],
            [643.6935, -1344.6628, 0],
            [650.1476, -1325.6254, 0],
            [650.3134, -1315.7352, 0],
            [637.0555, -1327.7909, 0],
            [620.877, -1339.9495, 0],
            [608.1253, -1345.1424, 0],
            [601.3601, -1345.9857, 0],
            [592.492, -1349.1671, 0],
            [582.5011, -1347.5158, 0],
            [581.925, -1330.1262, 0],
            [594.1877, -1293.446, 0],
            [601.6005, -1267.7678, 0],
            [600.7397, -1256.6438, 0],
            [597.5779, -1253.9048, 0],
            [590.6024, -1266.2456, 0],
            [573.9983, -1289.2598, 0],
            [553.9463, -1309.2458, 0],
            [530.5538, -1325.2375, 0],
            [517.6384, -1331.4336, 0],
            [488.163, -1342.9209, 0],
            [443.5064, -1356.1802, 0],
            [416.1543, -1369.4746, 0],
            [403.9019, -1379.2847, 0],
            [380.9121, -1390.6932, 0],
            [348.566, -1410.6318, 0],
            [324.3114, -1417.7687, 0],
            [310.3185, -1417.4232, 0],
            [299.9719, -1413.2299, 0],
            [282.8078, -1411.3531, 0],
            [270.4099, -1416.5596, 0],
            [262.8508, -1426.9341, 0],
            [260.2032, -1440.561, 0],
            [262.5398, -1455.5251, 0],
            [269.9331, -1469.9108, 0],
            [282.456, -1481.8027, 0],
            [290.6637, -1486.2149, 0],
            [296.3477, -1479.1873, 0],
            [311.3578, -1470.247, 0],
            [328.9065, -1467.2165, 0],
            [346.2124, -1469.0036, 0],
            [360.4941, -1474.5162, 0],
            [368.9704, -1482.6622, 0],
            [368.8598, -1492.3496, 0],
            [357.3809, -1502.4861, 0],
            [346.5093, -1507.3815, 0],
            [335.9531, -1509.1062, 0],
            [323.5508, -1515.0617, 0],
            [320.9463, -1522.9873, 0],
            [325.9612, -1531.2375, 0],
            [336.4166, -1538.1669, 0],
            [350.134, -1542.13, 0],
            [364.9349, -1541.4812, 0],
            [378.6405, -1534.5751, 0],
            [384.4018, -1528.2613, 0],
            [387.7235, -1521.5487, 0],
            [397.1263, -1509.7961, 0],
            [416.0832, -1497.2581, 0],
            [437.5903, -1492.2841, 0],
            [451.5266, -1493.9785, 0],
            [463.8687, -1500.2472, 0],
            [473.5255, -1511.575, 0],
            [477.006, -1519.2877, 0],
            [480.8127, -1532.0785, 0],
            [478.5836, -1557.3626, 0],
            [461.8682, -1594.0134, 0],
            [450.5476, -1617.1836, 0],
            [438.1993, -1637.2853, 0],
            [415.6431, -1679.6299, 0],
            [405.5685, -1701.8502, 0],
            [398.5587, -1716.7701, 0],
            [392.7436, -1749.4037, 0],
            [398.1937, -1800.5402, 0],
            [406.3457, -1832.356, 0],
            [418.6254, -1854.7171, 0],
            [436.3035, -1888.9691, 0],
            [451.4106, -1909.0749, 0],
            [460.942, -1917.4857, 0],
            [472.9774, -1931.3587, 0],
            [500.3101, -1953.9547, 0],
            [530.9238, -1970.5231, 0],
            [563.5373, -1982.0712, 0],
            [580.1935, -1986.2774, 0],
            [628.2323, -1995.07, 0],
            [725.0721, -2005.9874, 0],
            [774.8076, -2007.4816, 0],
            [808.681, -2011.7496, 0],
            [876.9616, -2015.2516, 0],
            [979.9869, -2015.4366, 0],
            [1048.506, -2018.0274, 0],
          ],
        ],
        tags: ['color/black'],
      },
    ],
  });
});
