import { Solid } from './types';
import { canonicalize as canonicalizeSurface } from '@jsxcad/geometry-surface';
import cleanSolid from './cleanSolid';
import { createNormalize3 } from '@jsxcad/algorithm-quantize';
import test from 'ava';

/**
 * canonicalize
 *
 * @function
 * @param {Solid} solid
 * @returns {Solid}
 */
export const canonicalize = (solid) => solid.map(canonicalizeSurface);

test('Top', t => {
  const normalize = createNormalize3();
  const a = [1, 1, 0];
  const b = [1, 0, 0];
  const c = [0, 0, 0];
  const d = [0, 1, 0];
  const solid = [[[a, b, c], [a, c, d]]];
  const clean = cleanSolid(solid, normalize);
  t.deepEqual(clean, [[[a, b, c, d]]]);
});

/*
test('Simple', t => {
  const normalize = createNormalize3();
  const solid = [[[[-10, -10, -10], [-5.01, -10, -10], [-5.01, -10, 10], [-10, -10, 10]], [[5.01, -10, -10], [10, -10, -10], [10, -10, 10], [5.01, -10, 10]], [[-5.01, -10, 10], [-5.01, -10, -10], [5.01, -10, -10], [5.01, -10, 10]]], [[[-10, -10, -10], [-10, -10, 10], [-10, 10, 10], [-10, 10, -10]]], [[[-5.01, 10, -10], [-10, 10, -10], [-10, 10, 10], [-5.01, 10, 10]], [[10, 10, 10], [10, 10, -10], [5.01, 10, -10], [5.01, 10, 10]], [[5.01, 10, -10], [-5.01, 10, -10], [-5.01, 10, 10], [5.01, 10, 10]]], [[[-5.01, -5.01, 10], [-10, -10, 10], [-5.01, -10, 10]], [[-10, -10, 10], [-5.01, -5.01, 10], [-5.01, 5.01, 10], [-5.01, 10, 10], [-10, 10, 10]], [[10, -10, 10], [10, 10, 10], [5.01, 5.01, 10], [5.01, -5.01, 10], [5.01, -10, 10]], [[5.01, 5.01, 10], [10, 10, 10], [5.01, 10, 10]], [[5.01, -10, 10], [5.01, -5.01, 10], [-5.01, -5.01, 10], [-5.01, -10, 10]], [[5.01, 10, 10], [-5.01, 10, 10], [-5.01, 5.01, 10], [5.01, 5.01, 10]], [[5.01, -5.01, 10], [5.01, 5.01, 10], [-5.01, -5.01, 10]], [[-5.01, 5.01, 10], [-5.01, -5.01, 10], [5.01, 5.01, 10]]], [[[-10, -10, -10], [-5.01, -5.01, -10], [-5.01, -10, -10]], [[-5.01, -5.01, -10], [-10, -10, -10], [-10, 10, -10], [-5.01, 10, -10], [-5.01, 5.01, -10], [-5.01, 5, -10]], [[5.01, 5.01, -10], [10, 10, -10], [10, -10, -10], [5.01, -10, -10], [5.01, -5.01, -10]], [[5.01, 10, -10], [10, 10, -10], [5.01, 5.01, -10]], [[5.01, -10, -10], [-5.01, -10, -10], [-5.01, -5.01, -10], [5, -5.01, -10], [5.01, -5.01, -10]], [[-5.01, 5.01, -10], [-5.01, 10, -10], [5.01, 10, -10], [5.01, 5.01, -10], [5, 5.01, -10]], [[5.01, -5.01, -10], [5, -5.01, -10], [5, 5, -10], [5.01, 5.01, -10]], [[5.01, 5.01, -10], [5, 5, -10], [5, 5.01, -10]], [[5, 5.01, -10], [5, 5, -10], [-5.01, 5, -10], [-5.01, 5.01, -10]], [[5, -5.01, -10], [-5.01, -5.01, -10], [5, 5, -10]], [[5, 5, -10], [-5.01, -5.01, -10], [-5.01, 5, -10]]], [[[10, 10, -10], [10, 10, 10], [10, -10, 10], [10, -10, -10]]]];
  const clean = cleanSolid(solid, normalize);
  // console.log(`QQ/clean: ${JSON.stringify(clean)}`);
  t.deepEqual(clean,
              [[[[10, 10, 10], [10, 10, -10], [5.01, 10, -10], [5.01, 10, -10], [-5.01, 10, -10], [-5.01, 10, -10], [-10, 10, -10], [-10, 10, 10], [-5.01, 10, 10], [-5.01, 10, 10], [5.01, 10, 10], [5.01, 10, 10]]],
               [[[10, 10, 10], [10, -10, 10], [10, -10, -10], [10, 10, -10]]],
               [[[-10, 10, 10], [-10, -10, 10], [-10, -10, 10], [-5.01, -10, 10], [-5.01, -10, 10], [5.01, -10, 10], [5.01, -10, 10], [10, -10, 10], [10, 10, 10], [10, 10, 10], [5.01, 10, 10], [5.01, 10, 10], [-5.01, 10, 10], [-5.01, 10, 10]]],
               [[[-10, 10, -10], [-10, -10, -10], [-10, -10, 10], [-10, 10, 10]]],
               [[[10, -10, -10], [5.01, -10, -10], [5.01, -10, -10], [-5.01, -10, -10], [-5.01, -10, -10], [-10, -10, -10], [-10, -10, -10], [-10, 10, -10], [-5.01, 10, -10], [-5.01, 10, -10], [5.01, 10, -10], [5.01, 10, -10], [10, 10, -10], [10, 10, -10]]],
               [[[5.01, -10, -10], [5.01, -10, -10], [10, -10, -10], [10, -10, 10], [5.01, -10, 10], [5.01, -10, 10], [-5.01, -10, 10], [-5.01, -10, 10], [-10, -10, 10], [-10, -10, -10], [-5.01, -10, -10], [-5.01, -10, -10]]]]);
});
*/
