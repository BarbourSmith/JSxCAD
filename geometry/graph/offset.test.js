import { fromSurface } from './fromSurface.js';
import { initCgal } from '@jsxcad/algorithm-cgal';
import { offset } from './offset.js';
import test from 'ava';

test.beforeEach(async (t) => {
  await initCgal();
});

test('offset', (t) => {
  const square = [
    [
      [-0.5, 0.5, -0.5],
      [0.5, 0.5, -0.5],
      [0.5, -0.5, -0.5],
    ],
    [
      [0.5, -0.5, -0.5],
      [-0.5, -0.5, -0.5],
      [-0.5, 0.5, -0.5],
    ],
  ];
  const graph = fromSurface(square);
  const offsetGraph = offset(graph, -0.2);
  t.deepEqual(JSON.parse(JSON.stringify(offsetGraph)), {
    isClosed: false,
    isLazy: false,
    edges: [
      { point: 0, next: 2, twin: 1, facet: 0, face: 0 },
      { point: 1, next: 33, twin: 0, facet: -1, face: -1 },
      { point: 1, next: 4, twin: 3, facet: 0, face: 0 },
      { point: 2, next: 1, twin: 2, facet: -1, face: -1 },
      { point: 2, next: 6, twin: 5, facet: 0, face: 0 },
      { point: 3, next: 3, twin: 4, facet: -1, face: -1 },
      { point: 3, next: 8, twin: 7, facet: 0, face: 0 },
      { point: 4, next: 5, twin: 6, facet: -1, face: -1 },
      { point: 4, next: 10, twin: 9, facet: 0, face: 0 },
      { point: 5, next: 7, twin: 8, facet: -1, face: -1 },
      { point: 5, next: 12, twin: 11, facet: 0, face: 0 },
      { point: 6, next: 9, twin: 10, facet: -1, face: -1 },
      { point: 6, next: 14, twin: 13, facet: 0, face: 0 },
      { point: 7, next: 11, twin: 12, facet: -1, face: -1 },
      { point: 7, next: 16, twin: 15, facet: 0, face: 0 },
      { point: 8, next: 13, twin: 14, facet: -1, face: -1 },
      { point: 8, next: 18, twin: 17, facet: 0, face: 0 },
      { point: 9, next: 15, twin: 16, facet: -1, face: -1 },
      { point: 9, next: 20, twin: 19, facet: 0, face: 0 },
      { point: 10, next: 17, twin: 18, facet: -1, face: -1 },
      { point: 10, next: 22, twin: 21, facet: 0, face: 0 },
      { point: 11, next: 19, twin: 20, facet: -1, face: -1 },
      { point: 11, next: 24, twin: 23, facet: 0, face: 0 },
      { point: 12, next: 21, twin: 22, facet: -1, face: -1 },
      { point: 12, next: 26, twin: 25, facet: 0, face: 0 },
      { point: 13, next: 23, twin: 24, facet: -1, face: -1 },
      { point: 13, next: 28, twin: 27, facet: 0, face: 0 },
      { point: 14, next: 25, twin: 26, facet: -1, face: -1 },
      { point: 14, next: 30, twin: 29, facet: 0, face: 0 },
      { point: 15, next: 27, twin: 28, facet: -1, face: -1 },
      { point: 15, next: 32, twin: 31, facet: 0, face: 0 },
      { point: 16, next: 29, twin: 30, facet: -1, face: -1 },
      { point: 16, next: 0, twin: 33, facet: 0, face: 0 },
      { point: 0, next: 31, twin: 32, facet: -1, face: -1 },
    ],
    points: [
      [0.30000001192092896, 0.5, 0.5],
      [0.5, 0.30000001192092896, 0.5],
      [0.480396568775177, 0.30096304416656494, 0.5],
      [0.46098193526268005, 0.3038429319858551, 0.5],
      [0.44194307923316956, 0.3086119294166565, 0.5],
      [0.4234633147716522, 0.3152240812778473, 0.5],
      [0.40572065114974976, 0.32361575961112976, 0.5],
      [0.3888859450817108, 0.3337060809135437, 0.5],
      [0.37312135100364685, 0.3453979194164276, 0.5],
      [0.3585786521434784, 0.3585786521434784, 0.5],
      [0.3453979194164276, 0.37312135100364685, 0.5],
      [0.3337060809135437, 0.3888859450817108, 0.5],
      [0.32361575961112976, 0.40572065114974976, 0.5],
      [0.3152240812778473, 0.4234633147716522, 0.5],
      [0.3086119294166565, 0.44194307923316956, 0.5],
      [0.3038429319858551, 0.46098193526268005, 0.5],
      [0.30096304416656494, 0.480396568775177, 0.5],
      [0.30000001192092896, 0.30000001192092896, 0.5],
      [0.5, -0.30000001192092896, 0.5],
      [0.30000001192092896, -0.5, 0.5],
      [0.30096304416656494, -0.480396568775177, 0.5],
      [0.3038429319858551, -0.46098193526268005, 0.5],
      [0.3086119294166565, -0.44194307923316956, 0.5],
      [0.3152240812778473, -0.4234633147716522, 0.5],
      [0.32361575961112976, -0.40572065114974976, 0.5],
      [0.3337060809135437, -0.3888859450817108, 0.5],
      [0.3453979194164276, -0.37312135100364685, 0.5],
      [0.3585786521434784, -0.3585786521434784, 0.5],
      [0.37312135100364685, -0.3453979194164276, 0.5],
      [0.3888859450817108, -0.3337060809135437, 0.5],
      [0.40572065114974976, -0.32361575961112976, 0.5],
      [0.4234633147716522, -0.3152240812778473, 0.5],
      [0.44194307923316956, -0.3086119294166565, 0.5],
      [0.46098193526268005, -0.3038429319858551, 0.5],
      [0.480396568775177, -0.30096304416656494, 0.5],
      [0.30000001192092896, -0.30000001192092896, 0.5],
      [-0.30000001192092896, -0.5, 0.5],
      [-0.5, -0.30000001192092896, 0.5],
      [-0.480396568775177, -0.30096304416656494, 0.5],
      [-0.46098193526268005, -0.3038429319858551, 0.5],
      [-0.44194307923316956, -0.3086119294166565, 0.5],
      [-0.4234633147716522, -0.3152240812778473, 0.5],
      [-0.40572065114974976, -0.32361575961112976, 0.5],
      [-0.3888859450817108, -0.3337060809135437, 0.5],
      [-0.37312135100364685, -0.3453979194164276, 0.5],
      [-0.3585786521434784, -0.3585786521434784, 0.5],
      [-0.3453979194164276, -0.37312135100364685, 0.5],
      [-0.3337060809135437, -0.3888859450817108, 0.5],
      [-0.32361575961112976, -0.40572065114974976, 0.5],
      [-0.3152240812778473, -0.4234633147716522, 0.5],
      [-0.3086119294166565, -0.44194307923316956, 0.5],
      [-0.3038429319858551, -0.46098193526268005, 0.5],
      [-0.30096304416656494, -0.480396568775177, 0.5],
      [-0.30000001192092896, -0.30000001192092896, 0.5],
      [-0.5, 0.30000001192092896, 0.5],
      [-0.30000001192092896, 0.5, 0.5],
      [-0.30096304416656494, 0.480396568775177, 0.5],
      [-0.3038429319858551, 0.46098193526268005, 0.5],
      [-0.3086119294166565, 0.44194307923316956, 0.5],
      [-0.3152240812778473, 0.4234633147716522, 0.5],
      [-0.32361575961112976, 0.40572065114974976, 0.5],
      [-0.3337060809135437, 0.3888859450817108, 0.5],
      [-0.3453979194164276, 0.37312135100364685, 0.5],
      [-0.3585786521434784, 0.3585786521434784, 0.5],
      [-0.37312135100364685, 0.3453979194164276, 0.5],
      [-0.3888859450817108, 0.3337060809135437, 0.5],
      [-0.40572065114974976, 0.32361575961112976, 0.5],
      [-0.4234633147716522, 0.3152240812778473, 0.5],
      [-0.44194307923316956, 0.3086119294166565, 0.5],
      [-0.46098193526268005, 0.3038429319858551, 0.5],
      [-0.480396568775177, 0.30096304416656494, 0.5],
      [-0.30000001192092896, 0.30000001192092896, 0.5],
    ],
    exactPoints: [
      ['5033165/16777216', '1/2', '1/2'],
      ['1/2', '5033165/16777216', '1/2'],
      ['8059717/16777216', '2524661/8388608', '1/2'],
      ['15467987/33554432', '10195277/33554432', '1/2'],
      ['14829149/33554432', '5177649/16777216', '1/2'],
      ['14209071/33554432', '10577165/33554432', '1/2'],
      ['6806863/16777216', '10858743/33554432', '1/2'],
      ['13048847/33554432', '5598659/16777216', '1/2'],
      ['12519875/33554432', '11589631/33554432', '1/2'],
      ['12031903/33554432', '12031903/33554432', '1/2'],
      ['11589631/33554432', '12519875/33554432', '1/2'],
      ['5598659/16777216', '13048847/33554432', '1/2'],
      ['10858743/33554432', '6806863/16777216', '1/2'],
      ['10577165/33554432', '14209071/33554432', '1/2'],
      ['5177649/16777216', '14829149/33554432', '1/2'],
      ['10195277/33554432', '15467987/33554432', '1/2'],
      ['2524661/8388608', '8059717/16777216', '1/2'],
      ['5033165/16777216', '5033165/16777216', '1/2'],
      ['1/2', '-5033165/16777216', '1/2'],
      ['5033165/16777216', '-1/2', '1/2'],
      ['2524661/8388608', '-8059717/16777216', '1/2'],
      ['10195277/33554432', '-15467987/33554432', '1/2'],
      ['5177649/16777216', '-14829149/33554432', '1/2'],
      ['10577165/33554432', '-14209071/33554432', '1/2'],
      ['10858743/33554432', '-6806863/16777216', '1/2'],
      ['5598659/16777216', '-13048847/33554432', '1/2'],
      ['11589631/33554432', '-12519875/33554432', '1/2'],
      ['12031903/33554432', '-12031903/33554432', '1/2'],
      ['12519875/33554432', '-11589631/33554432', '1/2'],
      ['13048847/33554432', '-5598659/16777216', '1/2'],
      ['6806863/16777216', '-10858743/33554432', '1/2'],
      ['14209071/33554432', '-10577165/33554432', '1/2'],
      ['14829149/33554432', '-5177649/16777216', '1/2'],
      ['15467987/33554432', '-10195277/33554432', '1/2'],
      ['8059717/16777216', '-2524661/8388608', '1/2'],
      ['5033165/16777216', '-5033165/16777216', '1/2'],
      ['-5033165/16777216', '-1/2', '1/2'],
      ['-1/2', '-5033165/16777216', '1/2'],
      ['-8059717/16777216', '-2524661/8388608', '1/2'],
      ['-15467987/33554432', '-10195277/33554432', '1/2'],
      ['-14829149/33554432', '-5177649/16777216', '1/2'],
      ['-14209071/33554432', '-10577165/33554432', '1/2'],
      ['-6806863/16777216', '-10858743/33554432', '1/2'],
      ['-13048847/33554432', '-5598659/16777216', '1/2'],
      ['-12519875/33554432', '-11589631/33554432', '1/2'],
      ['-12031903/33554432', '-12031903/33554432', '1/2'],
      ['-11589631/33554432', '-12519875/33554432', '1/2'],
      ['-5598659/16777216', '-13048847/33554432', '1/2'],
      ['-10858743/33554432', '-6806863/16777216', '1/2'],
      ['-10577165/33554432', '-14209071/33554432', '1/2'],
      ['-5177649/16777216', '-14829149/33554432', '1/2'],
      ['-10195277/33554432', '-15467987/33554432', '1/2'],
      ['-2524661/8388608', '-8059717/16777216', '1/2'],
      ['-5033165/16777216', '-5033165/16777216', '1/2'],
      ['-1/2', '5033165/16777216', '1/2'],
      ['-5033165/16777216', '1/2', '1/2'],
      ['-2524661/8388608', '8059717/16777216', '1/2'],
      ['-10195277/33554432', '15467987/33554432', '1/2'],
      ['-5177649/16777216', '14829149/33554432', '1/2'],
      ['-10577165/33554432', '14209071/33554432', '1/2'],
      ['-10858743/33554432', '6806863/16777216', '1/2'],
      ['-5598659/16777216', '13048847/33554432', '1/2'],
      ['-11589631/33554432', '12519875/33554432', '1/2'],
      ['-12031903/33554432', '12031903/33554432', '1/2'],
      ['-12519875/33554432', '11589631/33554432', '1/2'],
      ['-13048847/33554432', '5598659/16777216', '1/2'],
      ['-6806863/16777216', '10858743/33554432', '1/2'],
      ['-14209071/33554432', '10577165/33554432', '1/2'],
      ['-14829149/33554432', '5177649/16777216', '1/2'],
      ['-15467987/33554432', '10195277/33554432', '1/2'],
      ['-8059717/16777216', '2524661/8388608', '1/2'],
      ['-5033165/16777216', '5033165/16777216', '1/2'],
    ],
    faces: [{ plane: [0, 0, -1, 0.5], exactPlane: ['0', '0', '-1', '1/2'] }],
    facets: [{ edge: 32 }],
    isOutline: true,
  });
});
