import {
  unitRegularIcosahedronPolygons,
  unitRegularTetrahedronPolygons,
} from '@jsxcad/data-shape';

import { fromPolygons } from './fromPolygons.js';
import { fuse } from './fuse.js';
import { initOcct } from './occt.js';
import test from 'ava';
import { toGraph } from './toGraph.js';

test.beforeEach(async (t) => {
  await initOcct();
});

test('fuse', (t) => {
  const a = fromPolygons(unitRegularIcosahedronPolygons);
  const b = fromPolygons(unitRegularTetrahedronPolygons);
  const fused = fuse(a, b);
  const graph = toGraph(fused);
  t.deepEqual(graph, {
    edges: [
      { loop: 0, next: 1, point: 0, twin: 4 },
      { loop: 0, next: 2, point: 1, twin: 24 },
      { loop: 0, next: 3, point: 2, twin: 19 },
      { loop: 0, next: 0, point: 3, twin: 11 },
      { loop: 1, next: 5, point: 1, twin: 4 },
      { loop: 1, next: 6, point: 0, twin: 10 },
      { loop: 1, next: 4, point: 4, twin: 25 },
      { loop: 2, next: 8, point: 5, twin: 30 },
      { loop: 2, next: 9, point: 6, twin: 42 },
      { loop: 2, next: 7, point: 7, twin: 52 },
      { loop: 3, next: 11, point: 4, twin: 10 },
      { loop: 3, next: 12, point: 0, twin: 11 },
      { loop: 3, next: 13, point: 3, twin: 21 },
      { loop: 3, next: 14, point: 8, twin: 80 },
      { loop: 3, next: 15, point: 9, twin: 75 },
      { loop: 3, next: 16, point: 10, twin: 71 },
      { loop: 3, next: 17, point: 11, twin: 68 },
      { loop: 3, next: 18, point: 12, twin: 67 },
      { loop: 3, next: 10, point: 13, twin: 26 },
      { loop: 4, next: 20, point: 3, twin: 19 },
      { loop: 4, next: 21, point: 2, twin: 78 },
      { loop: 4, next: 19, point: 8, twin: 21 },
      { loop: 5, next: 23, point: 1, twin: 65 },
      { loop: 5, next: 24, point: 14, twin: 77 },
      { loop: 5, next: 22, point: 2, twin: 24 },
      { loop: 6, next: 26, point: 1, twin: 25 },
      { loop: 6, next: 27, point: 4, twin: 26 },
      { loop: 6, next: 25, point: 13, twin: 66 },
      { loop: 7, next: 29, point: 5, twin: 54 },
      { loop: 7, next: 30, point: 15, twin: 40 },
      { loop: 7, next: 28, point: 6, twin: 30 },
      { loop: 8, next: 32, point: 16, twin: 82 },
      { loop: 8, next: 33, point: 17, twin: 109 },
      { loop: 8, next: 34, point: 18, twin: 107 },
      { loop: 8, next: 35, point: 19, twin: 103 },
      { loop: 8, next: 36, point: 20, twin: 100 },
      { loop: 8, next: 37, point: 21, twin: 95 },
      { loop: 8, next: 38, point: 22, twin: 91 },
      { loop: 8, next: 39, point: 23, twin: 89 },
      { loop: 8, next: 31, point: 24, twin: 87 },
      { loop: 9, next: 41, point: 6, twin: 40 },
      { loop: 9, next: 42, point: 15, twin: 53 },
      { loop: 9, next: 40, point: 7, twin: 42 },
      { loop: 10, next: 44, point: 25, twin: 112 },
      { loop: 10, next: 45, point: 26, twin: 139 },
      { loop: 10, next: 46, point: 27, twin: 135 },
      { loop: 10, next: 47, point: 28, twin: 132 },
      { loop: 10, next: 48, point: 29, twin: 130 },
      { loop: 10, next: 49, point: 30, twin: 126 },
      { loop: 10, next: 50, point: 31, twin: 123 },
      { loop: 10, next: 51, point: 32, twin: 118 },
      { loop: 10, next: 43, point: 33, twin: 114 },
      { loop: 11, next: 53, point: 5, twin: 52 },
      { loop: 11, next: 54, point: 7, twin: 53 },
      { loop: 11, next: 52, point: 15, twin: 54 },
      { loop: 12, next: 56, point: 34, twin: 142 },
      { loop: 12, next: 57, point: 35, twin: 168 },
      { loop: 12, next: 58, point: 36, twin: 166 },
      { loop: 12, next: 59, point: 37, twin: 164 },
      { loop: 12, next: 60, point: 38, twin: 159 },
      { loop: 12, next: 61, point: 39, twin: 156 },
      { loop: 12, next: 62, point: 40, twin: 154 },
      { loop: 12, next: 63, point: 41, twin: 150 },
      { loop: 12, next: 55, point: 42, twin: 147 },
      { loop: 13, next: 65, point: 12, twin: 70 },
      { loop: 13, next: 66, point: 14, twin: 65 },
      { loop: 13, next: 67, point: 1, twin: 66 },
      { loop: 13, next: 64, point: 13, twin: 67 },
      { loop: 14, next: 69, point: 12, twin: 68 },
      { loop: 14, next: 70, point: 11, twin: 73 },
      { loop: 14, next: 68, point: 14, twin: 70 },
      { loop: 15, next: 72, point: 11, twin: 71 },
      { loop: 15, next: 73, point: 10, twin: 74 },
      { loop: 15, next: 71, point: 14, twin: 73 },
      { loop: 16, next: 75, point: 14, twin: 74 },
      { loop: 16, next: 76, point: 10, twin: 75 },
      { loop: 16, next: 77, point: 9, twin: 79 },
      { loop: 16, next: 74, point: 2, twin: 77 },
      { loop: 17, next: 79, point: 8, twin: 78 },
      { loop: 17, next: 80, point: 2, twin: 79 },
      { loop: 17, next: 78, point: 9, twin: 80 },
      { loop: 18, next: 82, point: 43, twin: 110 },
      { loop: 18, next: 83, point: 17, twin: 82 },
      { loop: 18, next: 81, point: 16, twin: 86 },
      { loop: 19, next: 85, point: 24, twin: 88 },
      { loop: 19, next: 86, point: 44, twin: 173 },
      { loop: 19, next: 87, point: 43, twin: 86 },
      { loop: 19, next: 84, point: 16, twin: 87 },
      { loop: 20, next: 89, point: 44, twin: 88 },
      { loop: 20, next: 90, point: 24, twin: 89 },
      { loop: 20, next: 88, point: 23, twin: 93 },
      { loop: 21, next: 92, point: 23, twin: 91 },
      { loop: 21, next: 93, point: 22, twin: 94 },
      { loop: 21, next: 91, point: 44, twin: 93 },
      { loop: 22, next: 95, point: 44, twin: 94 },
      { loop: 22, next: 96, point: 22, twin: 95 },
      { loop: 22, next: 97, point: 21, twin: 99 },
      { loop: 22, next: 94, point: 45, twin: 171 },
      { loop: 23, next: 99, point: 20, twin: 102 },
      { loop: 23, next: 100, point: 45, twin: 99 },
      { loop: 23, next: 98, point: 21, twin: 100 },
      { loop: 24, next: 102, point: 19, twin: 106 },
      { loop: 24, next: 103, point: 45, twin: 102 },
      { loop: 24, next: 101, point: 20, twin: 103 },
      { loop: 25, next: 105, point: 18, twin: 108 },
      { loop: 25, next: 106, point: 43, twin: 172 },
      { loop: 25, next: 107, point: 45, twin: 106 },
      { loop: 25, next: 104, point: 19, twin: 107 },
      { loop: 26, next: 109, point: 43, twin: 108 },
      { loop: 26, next: 110, point: 18, twin: 109 },
      { loop: 26, next: 108, point: 17, twin: 110 },
      { loop: 27, next: 112, point: 46, twin: 140 },
      { loop: 27, next: 113, point: 26, twin: 112 },
      { loop: 27, next: 111, point: 25, twin: 116 },
      { loop: 28, next: 115, point: 25, twin: 114 },
      { loop: 28, next: 116, point: 33, twin: 117 },
      { loop: 28, next: 114, point: 46, twin: 116 },
      { loop: 29, next: 118, point: 46, twin: 117 },
      { loop: 29, next: 119, point: 33, twin: 118 },
      { loop: 29, next: 120, point: 32, twin: 122 },
      { loop: 29, next: 117, point: 47, twin: 175 },
      { loop: 30, next: 122, point: 31, twin: 125 },
      { loop: 30, next: 123, point: 47, twin: 122 },
      { loop: 30, next: 121, point: 32, twin: 123 },
      { loop: 31, next: 125, point: 30, twin: 129 },
      { loop: 31, next: 126, point: 47, twin: 125 },
      { loop: 31, next: 124, point: 31, twin: 126 },
      { loop: 32, next: 128, point: 29, twin: 131 },
      { loop: 32, next: 129, point: 48, twin: 176 },
      { loop: 32, next: 130, point: 47, twin: 129 },
      { loop: 32, next: 127, point: 30, twin: 130 },
      { loop: 33, next: 132, point: 48, twin: 131 },
      { loop: 33, next: 133, point: 29, twin: 132 },
      { loop: 33, next: 131, point: 28, twin: 134 },
      { loop: 34, next: 135, point: 48, twin: 134 },
      { loop: 34, next: 136, point: 28, twin: 135 },
      { loop: 34, next: 134, point: 27, twin: 138 },
      { loop: 35, next: 138, point: 46, twin: 174 },
      { loop: 35, next: 139, point: 48, twin: 138 },
      { loop: 35, next: 140, point: 27, twin: 139 },
      { loop: 35, next: 137, point: 26, twin: 140 },
      { loop: 36, next: 142, point: 49, twin: 169 },
      { loop: 36, next: 143, point: 35, twin: 142 },
      { loop: 36, next: 144, point: 34, twin: 146 },
      { loop: 36, next: 141, point: 50, twin: 179 },
      { loop: 37, next: 146, point: 42, twin: 149 },
      { loop: 37, next: 147, point: 50, twin: 146 },
      { loop: 37, next: 145, point: 34, twin: 147 },
      { loop: 38, next: 149, point: 41, twin: 153 },
      { loop: 38, next: 150, point: 50, twin: 149 },
      { loop: 38, next: 148, point: 42, twin: 150 },
      { loop: 39, next: 152, point: 40, twin: 155 },
      { loop: 39, next: 153, point: 51, twin: 177 },
      { loop: 39, next: 154, point: 50, twin: 153 },
      { loop: 39, next: 151, point: 41, twin: 154 },
      { loop: 40, next: 156, point: 51, twin: 155 },
      { loop: 40, next: 157, point: 40, twin: 156 },
      { loop: 40, next: 155, point: 39, twin: 158 },
      { loop: 41, next: 159, point: 51, twin: 158 },
      { loop: 41, next: 160, point: 39, twin: 159 },
      { loop: 41, next: 158, point: 38, twin: 163 },
      { loop: 42, next: 162, point: 37, twin: 165 },
      { loop: 42, next: 163, point: 49, twin: 178 },
      { loop: 42, next: 164, point: 51, twin: 163 },
      { loop: 42, next: 161, point: 38, twin: 164 },
      { loop: 43, next: 166, point: 49, twin: 165 },
      { loop: 43, next: 167, point: 37, twin: 166 },
      { loop: 43, next: 165, point: 36, twin: 170 },
      { loop: 44, next: 169, point: 36, twin: 168 },
      { loop: 44, next: 170, point: 35, twin: 169 },
      { loop: 44, next: 168, point: 49, twin: 170 },
      { loop: 45, next: 172, point: 44, twin: 171 },
      { loop: 45, next: 173, point: 45, twin: 172 },
      { loop: 45, next: 171, point: 43, twin: 173 },
      { loop: 46, next: 175, point: 48, twin: 174 },
      { loop: 46, next: 176, point: 46, twin: 175 },
      { loop: 46, next: 174, point: 47, twin: 176 },
      { loop: 47, next: 178, point: 50, twin: 177 },
      { loop: 47, next: 179, point: 51, twin: 178 },
      { loop: 47, next: 177, point: 49, twin: 179 },
    ],
    faces: [
      { holes: [], loop: 0 },
      { holes: [], loop: 1 },
      { holes: [3], loop: 2 },
      { holes: [], loop: 4 },
      { holes: [], loop: 5 },
      { holes: [], loop: 6 },
      { holes: [8], loop: 7 },
      { holes: [10], loop: 9 },
      { holes: [12], loop: 11 },
      { holes: [], loop: 13 },
      { holes: [], loop: 14 },
      { holes: [], loop: 15 },
      { holes: [], loop: 16 },
      { holes: [], loop: 17 },
      { holes: [], loop: 18 },
      { holes: [], loop: 19 },
      { holes: [], loop: 20 },
      { holes: [], loop: 21 },
      { holes: [], loop: 22 },
      { holes: [], loop: 23 },
      { holes: [], loop: 24 },
      { holes: [], loop: 25 },
      { holes: [], loop: 26 },
      { holes: [], loop: 27 },
      { holes: [], loop: 28 },
      { holes: [], loop: 29 },
      { holes: [], loop: 30 },
      { holes: [], loop: 31 },
      { holes: [], loop: 32 },
      { holes: [], loop: 33 },
      { holes: [], loop: 34 },
      { holes: [], loop: 35 },
      { holes: [], loop: 36 },
      { holes: [], loop: 37 },
      { holes: [], loop: 38 },
      { holes: [], loop: 39 },
      { holes: [], loop: 40 },
      { holes: [], loop: 41 },
      { holes: [], loop: 42 },
      { holes: [], loop: 43 },
      { holes: [], loop: 44 },
      { holes: [], loop: 45 },
      { holes: [], loop: 46 },
      { holes: [], loop: 47 },
    ],
    loops: [
      { edge: 3, face: 0 },
      { edge: 6, face: 1 },
      { edge: 9, face: 2 },
      { edge: 18, face: 2 },
      { edge: 21, face: 3 },
      { edge: 24, face: 4 },
      { edge: 27, face: 5 },
      { edge: 30, face: 6 },
      { edge: 39, face: 6 },
      { edge: 42, face: 7 },
      { edge: 51, face: 7 },
      { edge: 54, face: 8 },
      { edge: 63, face: 8 },
      { edge: 67, face: 9 },
      { edge: 70, face: 10 },
      { edge: 73, face: 11 },
      { edge: 77, face: 12 },
      { edge: 80, face: 13 },
      { edge: 83, face: 14 },
      { edge: 87, face: 15 },
      { edge: 90, face: 16 },
      { edge: 93, face: 17 },
      { edge: 97, face: 18 },
      { edge: 100, face: 19 },
      { edge: 103, face: 20 },
      { edge: 107, face: 21 },
      { edge: 110, face: 22 },
      { edge: 113, face: 23 },
      { edge: 116, face: 24 },
      { edge: 120, face: 25 },
      { edge: 123, face: 26 },
      { edge: 126, face: 27 },
      { edge: 130, face: 28 },
      { edge: 133, face: 29 },
      { edge: 136, face: 30 },
      { edge: 140, face: 31 },
      { edge: 144, face: 32 },
      { edge: 147, face: 33 },
      { edge: 150, face: 34 },
      { edge: 154, face: 35 },
      { edge: 157, face: 36 },
      { edge: 160, face: 37 },
      { edge: 164, face: 38 },
      { edge: 167, face: 39 },
      { edge: 170, face: 40 },
      { edge: 173, face: 41 },
      { edge: 176, face: 42 },
      { edge: 179, face: 43 },
    ],
    points: [
      [-0.85065, 0, -0.1493500000000001],
      [-0.85065, 0, -0.52573],
      [-0.52573, -0.85065, 0],
      [-0.6420381711144503, -0.5461518288855498, 0.18818999999999986],
      [-0.7787676808323047, 0.18818999999999997, -0.4094223191676953],
      [-1, -1, 1],
      [-1, 1, -1],
      [1, -1, -1],
      [-0.40942231916769534, -0.7787676808323047, 0.18818999999999994],
      [-0.14935000000000026, -0.85065, 0],
      [0.18818999999999997, -0.6420381711144504, -0.5461518288855497],
      [0.18818999999999997, -0.40942231916769534, -0.7787676808323047],
      [0, -0.14934999999999987, -0.85065],
      [-0.5461518288855496, 0.18819000000000005, -0.6420381711144505],
      [0, -0.52573, -0.85065],
      [1, 1, 1],
      [-0.5461518288855496, -0.18819000000000002, 0.6420381711144504],
      [-0.7787676808323047, -0.18818999999999997, 0.4094223191676953],
      [-0.85065, 0, 0.14935000000000015],
      [-0.6420381711144503, 0.5461518288855498, -0.18818999999999986],
      [-0.4094223191676954, 0.7787676808323047, -0.18818999999999986],
      [-0.1493500000000001, 0.85065, 0],
      [0.18818999999999997, 0.6420381711144504, 0.5461518288855497],
      [0.18818999999999997, 0.40942231916769534, 0.7787676808323047],
      [0, 0.14934999999999987, 0.85065],
      [-0.18819000000000008, 0.4094223191676953, -0.7787676808323047],
      [0, 0.14934999999999976, -0.85065],
      [0.5461518288855496, -0.18819000000000002, -0.6420381711144504],
      [0.7787676808323047, -0.18818999999999997, -0.4094223191676953],
      [0.85065, 0, -0.14935000000000004],
      [0.6420381711144504, 0.5461518288855497, 0.18818999999999997],
      [0.40942231916769534, 0.7787676808323047, 0.18818999999999994],
      [0.14935000000000004, 0.85065, 0],
      [-0.18819000000000008, 0.6420381711144505, -0.5461518288855496],
      [0.1493500000000001, -0.85065, 0],
      [-0.18819000000000008, -0.6420381711144505, 0.5461518288855496],
      [-0.18819000000000008, -0.4094223191676953, 0.7787676808323047],
      [0, -0.14934999999999976, 0.85065],
      [0.5461518288855496, 0.18819000000000002, 0.6420381711144504],
      [0.7787676808323047, 0.18818999999999997, 0.4094223191676953],
      [0.85065, 0, 0.1493500000000001],
      [0.6420381711144504, -0.5461518288855497, -0.18818999999999997],
      [0.40942231916769534, -0.7787676808323047, -0.18818999999999994],
      [-0.85065, 0, 0.52573],
      [0, 0.52573, 0.85065],
      [-0.52573, 0.85065, 0],
      [0, 0.52573, -0.85065],
      [0.52573, 0.85065, 0],
      [0.85065, 0, -0.52573],
      [0, -0.52573, 0.85065],
      [0.52573, -0.85065, 0],
      [0.85065, 0, 0.52573],
    ],
  });
});
