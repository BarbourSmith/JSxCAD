import { initCgal } from './getCgal.js';
import { offsetOfPolygon } from './offsetOfPolygon.js';
import test from 'ava';

test.beforeEach(async (t) => {
  await initCgal();
});

test('offsetOfPolygon/bow', (t) => {
  const polygon = [
    [0.25, -0.18899576365947723, 0],
    [0.7886751294136047, -0.5, 0],
    [0.7886751294136047, 0.5, 0],
    [0.25, 0.18899576365947723, 0],
    [-0.28867512941360474, 0.5, 0],
    [-0.28867512941360474, -0.5, 0],
  ];
  const xyPlane = [0, 0, 1, 0];
  const offset = offsetOfPolygon(0.1, 0.05, 0.5, xyPlane, polygon, []);
  t.deepEqual(offset, [
    {
      boundary: [
        [0.8886751294136047, 0.5, 0],
        [0.7386752568060326, 0.5866026139283714, 0],
        [0.3346683070639189, 0.35334988513213655, 0],
        [0.25, 0.30446611369236387, 0],
        [0.16533169293608102, 0.35334988513213655, 0],
        [-0.23867525680603263, 0.5866026139283714, 0],
        [-0.3886751294136047, 0.5, 0],
        [-0.3886751294136047, -0.5, 0],
        [-0.23867551288569605, -0.586602761775027, 0],
        [-0.10400613133733305, -0.5088521531632536, 0],
        [0.25, -0.3044659165607958, 0],
        [0.604006131337333, -0.5088521531632536, 0],
        [0.738675512885696, -0.586602761775027, 0],
        [0.8886751294136047, -0.5, 0],
      ],
      holes: [],
    },
    {
      boundary: [
        [0.9386751294136048, 0.5, 0],
        [0.7136753205022465, 0.6299039208925572, 0],
        [0.3096682427204121, 0.3966511181728062, 0],
        [0.25, 0.36220128870880725, 0],
        [0.19033175727958784, 0.3966511181728062, 0],
        [-0.21367532050224655, 0.6299039208925572, 0],
        [-0.43867512941360476, 0.5, 0],
        [-0.43867512941360476, -0.5, 0],
        [-0.2136757046217417, -0.6299041426625405, 0],
        [-0.07900619503343936, -0.5521534601276297, 0],
        [0.25, -0.3622009930114551, 0],
        [0.5790061950334393, -0.5521534601276297, 0],
        [0.7136757046217417, -0.6299041426625405, 0],
        [0.9386751294136048, -0.5, 0],
      ],
      holes: [],
    },
    {
      boundary: [
        [0.9886751294136047, 0.5, 0],
        [0.6886753841984605, 0.6732052278567429, 0],
        [0.2846681783769053, 0.4399523512134758, 0],
        [0.25, 0.41993646372525056, 0],
        [0.21533182162309467, 0.4399523512134758, 0],
        [-0.18867538419846053, 0.6732052278567429, 0],
        [-0.48867512941360475, 0.5, 0],
        [-0.48867512941360475, -0.5, 0],
        [-0.18867589635778736, -0.673205523550054, 0],
        [-0.05400625872954568, -0.5954547670920056, 0],
        [0.25, -0.41993606946211437, 0],
        [0.5540062587295457, -0.5954547670920056, 0],
        [0.6886758963577874, -0.673205523550054, 0],
        [0.9886751294136047, -0.5, 0],
      ],
      holes: [],
    },
    {
      boundary: [
        [1.0386751294136047, 0.5, 0],
        [0.6636754478946745, 0.7165065348209286, 0],
        [0.2596681140333985, 0.4832535842541454, 0],
        [0.25, 0.4776716387416938, 0],
        [0.24033188596660146, 0.4832535842541454, 0],
        [-0.16367544789467448, 0.7165065348209286, 0],
        [-0.5386751294136047, 0.5, 0],
        [-0.5386751294136047, -0.5, 0],
        [-0.16367608809383305, -0.7165069044375675, 0],
        [-0.029006322425652, -0.6387560740563817, 0],
        [0.25, -0.47767114591277365, 0],
        [0.5290063224256519, -0.6387560740563817, 0],
        [0.663676088093833, -0.7165069044375675, 0],
        [1.0386751294136047, -0.5, 0],
      ],
      holes: [],
    },
    {
      boundary: [
        [1.0886751294136046, 0.5, 0],
        [0.6386755115908884, 0.7598078417851144, 0],
        [0.25, 0.5354066928625096, 0],
        [-0.13867551159088842, 0.7598078417851144, 0],
        [-0.5886751294136047, 0.5, 0],
        [-0.5886751294136047, -0.5, 0],
        [-0.1386762798298787, -0.759808285325081, 0],
        [-0.004006386121758323, -0.6820573810207576, 0],
        [0.25, -0.5354062223634328, 0],
        [0.5040063861217583, -0.6820573810207576, 0],
        [0.6386762798298786, -0.759808285325081, 0],
        [1.0886751294136046, -0.5, 0],
      ],
      holes: [],
    },
    {
      boundary: [
        [1.1386751294136046, 0.5, 0],
        [0.6136755752871024, 0.8031091487493001, 0],
        [0.25, 0.5931416707482288, 0],
        [-0.1136755752871024, 0.8031091487493001, 0],
        [-0.6386751294136047, 0.5, 0],
        [-0.6386751294136047, -0.5, 0],
        [-0.11367647156592439, -0.8031096662125945, 0],
        [0.020993550182135355, -0.7253586879851336, 0],
        [0.25, -0.5931412988140922, 0],
        [0.4790064498178646, -0.7253586879851336, 0],
        [0.6136764715659243, -0.8031096662125945, 0],
        [1.1386751294136046, -0.5, 0],
      ],
      holes: [],
    },
    {
      boundary: [
        [1.1886751294136046, 0.5, 0],
        [0.5886756389833163, 0.8464104557134858, 0],
        [0.25, 0.6508766486339479, 0],
        [-0.08867563898331635, 0.8464104557134858, 0],
        [-0.6886751294136046, 0.5, 0],
        [-0.6886751294136046, -0.5, 0],
        [-0.08867666330197006, -0.8464110471001081, 0],
        [0.04599348648602904, -0.7686599949495097, 0],
        [0.25, -0.6508763752647514, 0],
        [0.4540065135139709, -0.7686599949495097, 0],
        [0.58867666330197, -0.8464110471001081, 0],
        [1.1886751294136046, -0.5, 0],
      ],
      holes: [],
    },
    {
      boundary: [
        [1.2386751294136047, 0.5, 0],
        [0.5636757026795303, 0.8897117626776716, 0],
        [0.25, 0.708611626519667, 0],
        [-0.06367570267953031, 0.8897117626776716, 0],
        [-0.7386751294136047, 0.5, 0],
        [-0.7386751294136047, -0.5, 0],
        [-0.06367685503801573, -0.8897124279876215, 0],
        [0.07099342278992271, -0.8119613019138856, 0],
        [0.25, -0.7086114517154107, 0],
        [0.42900657721007723, -0.8119613019138856, 0],
        [0.5636768550380157, -0.8897124279876215, 0],
        [1.2386751294136047, -0.5, 0],
      ],
      holes: [],
    },
    {
      boundary: [
        [1.2886751294136045, 0.5, 0],
        [0.5386757663757442, 0.9330130696418573, 0],
        [0.25, 0.7663466044053862, 0],
        [-0.03867576637574427, 0.9330130696418573, 0],
        [-0.7886751294136046, 0.5, 0],
        [-0.7886751294136046, -0.5, 0],
        [-0.03867704677406141, -0.9330138088751351, 0],
        [0.09599335909381639, -0.8552626088782616, 0],
        [0.25, -0.76634652816607, 0],
        [0.4040066409061836, -0.8552626088782616, 0],
        [0.5386770467740614, -0.9330138088751351, 0],
        [1.2886751294136045, -0.5, 0],
      ],
      holes: [],
    },
  ]);
});
