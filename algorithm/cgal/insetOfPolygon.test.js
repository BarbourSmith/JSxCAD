import { initCgal } from './getCgal.js';
import { insetOfPolygon } from './insetOfPolygon.js';
import test from 'ava';

test.beforeEach(async (t) => {
  await initCgal();
});

test('insetOfPolygon/bow', (t) => {
  const polygon = [
    [0.25, -0.18899576365947723, 0],
    [0.7886751294136047, -0.5, 0],
    [0.7886751294136047, 0.5, 0],
    [0.25, 0.18899576365947723, 0],
    [-0.28867512941360474, 0.5, 0],
    [-0.28867512941360474, -0.5, 0],
  ];
  const xyPlane = [0, 0, 1, 0];
  const inset = insetOfPolygon(0.1, 0.05, 0.5, xyPlane, polygon, []);
  t.deepEqual(inset, [
    {
      boundary: [
        [0.43466899807627163, 0.18014361049622352, 0],
        [0.29999961652790863, 0.10239300188445019, 0],
        [0.2912702996542111, 0.09790919842369931, 0],
        [0.2821435272342028, 0.09430260837915054, 0],
        [0.2727071950754898, 0.09160796518449552, 0],
        [0.2630521802151843, 0.08985121972674057, 0],
        [0.2532714657243591, 0.08904929042497865, 0],
        [0.24345924523024326, 0.08920990029676486, 0],
        [0.23371001578010042, 0.09033150258123562, 0],
        [0.22411766778300643, 0.09240329563526131, 0],
        [0.2147745807938841, 0.09540532695917436, 0],
        [0.20577073384788952, 0.09930868535024823, 0],
        [0.20000038347209131, 0.10239300188445019, 0],
        [0.20000038347209131, 0.10239300188445019, 0],
        [0.06533100192372832, 0.18014361049622352, 0],
        [-0.18867512941360473, 0.32679462205318693, 0],
        [-0.18867512941360473, -0.32679415155410513, 0],
        [0.2000001273924279, -0.10239314973110575, 0],
        [0.20872943100771263, -0.09790932045823651, 0],
        [0.21785619276318102, -0.09430270342631006, 0],
        [0.2272925169539324, -0.09160803232892126, 0],
        [0.23694752661959034, -0.08985125832179501, 0],
        [0.24672823873910932, -0.08904930009897032, 0],
        [0.25654045970809736, -0.08920988095652793, 0],
        [0.26628969247471745, -0.09033145441302715, 0],
        [0.2758820465979543, -0.09240321910296748, 0],
        [0.28522514246388697, -0.09540522279984298, 0],
        [0.29422900095187077, -0.0993085545669906, 0],
        [0.29999987260757205, -0.10239314973110575, 0],
        [0.29999987260757205, -0.10239314973110575, 0],
        [0.6886751294136046, -0.32679415155410513, 0],
        [0.6886751294136046, 0.32679462205318693, 0],
      ],
      holes: [],
    },
    {
      boundary: [
        [0.4596689343801653, 0.1368423035318475, 0],
        [0.324999424791863, 0.05909162099693667, 0],
        [0.31190544948131665, 0.05236591580581035, 0],
        [0.2982152908513042, 0.04695603073898719, 0],
        [0.2840607926132347, 0.042914065947004615, 0],
        [0.2695782703227765, 0.04027894776037219, 0],
        [0.2549071985865387, 0.03907605380772933, 0],
        [0.24018886784536492, 0.03931696861540865, 0],
        [0.22556502367015066, 0.04099937204211476, 0],
        [0.2111765016745097, 0.04410706162315331, 0],
        [0.19716187119082615, 0.04861010860902287, 0],
        [0.18365610077183434, 0.054465146195633696, 0],
        [0.17500057520813697, 0.05909162099693667, 0],
        [0.17500057520813697, 0.05909162099693667, 0],
        [0.04033106561983463, 0.1368423035318475, 0],
        [-0.13867512941360471, 0.2401919330797804, 0],
        [-0.13867512941360471, -0.24019175827551648, 0],
        [0.17500019108864182, -0.05909184276692, 0],
        [0.18809414651156892, -0.05236609885761617, 0],
        [0.2017842891447715, -0.046956173309726484, 0],
        [0.21593877543089857, -0.042914166663643255, 0],
        [0.23042128992938546, -0.04027900565295389, 0],
        [0.24509235810866398, -0.03907606831871685, 0],
        [0.25981068956214604, -0.03931693960505328, 0],
        [0.2744345387120761, -0.0409992997898021, 0],
        [0.2888230698969314, -0.044106946824712556, 0],
        [0.3028377136958304, -0.04860995237002583, 0],
        [0.31634350142780615, -0.05446495002074728, 0],
        [0.32499980891135816, -0.05909184276692, 0],
        [0.32499980891135816, -0.05909184276692, 0],
        [0.6386751294136047, -0.24019175827551648, 0],
        [0.6386751294136047, 0.2401919330797804, 0],
      ],
      holes: [],
    },
    {
      boundary: [
        [-0.08867512941360473, 0.15358924410637392, 0],
        [-0.08867512941360473, -0.15358936499692785, 0],
        [0.1500002547848558, -0.01579053580273427, 0],
        [0.16745886201542526, -0.006822877256995791, 0],
        [0.18457369551341735, 0, 0],
        [0.18457369551341735, 0, 0],
        [0.16636391676404488, 0.007322965527923192, 0],
        [0.15000076694418263, 0.01579024010942317, 0],
        [0.15000076694418263, 0.01579024010942317, 0],
        [0.015331129315940948, 0.09354099656747152, 0],
      ],
      holes: [],
    },
    {
      boundary: [
        [0.3499992330558173, 0.01579024010942317, 0],
        [0.3325405993084222, 0.006822633187921423, 0],
        [0.31542630448658265, 0, 0],
        [0.31542630448658265, 0, 0],
        [0.3336360832359551, -0.007322965527923192, 0],
        [0.34999974521514415, -0.01579053580273427, 0],
        [0.34999974521514415, -0.01579053580273427, 0],
        [0.5886751294136047, -0.15358936499692785, 0],
        [0.5886751294136047, 0.15358924410637392, 0],
        [0.484668870684059, 0.09354099656747152, 0],
      ],
      holes: [],
    },
    {
      boundary: [
        [-0.038675129413604736, 0.06698655513296743, 0],
        [-0.038675129413604736, -0.06698697171833924, 0],
        [0.07734994050214711, -9.393344456617873e-8, 0],
        [-0.009668806987952732, 0.05023968960309553, 0],
      ],
      holes: [],
    },
    {
      boundary: [
        [0.5096688069879527, 0.05023968960309553, 0],
        [0.42265005949785284, -9.393344456617873e-8, 0],
        [0.5386751294136047, -0.06698697171833924, 0],
        [0.5386751294136047, 0.06698655513296743, 0],
      ],
      holes: [],
    },
  ]);
});
