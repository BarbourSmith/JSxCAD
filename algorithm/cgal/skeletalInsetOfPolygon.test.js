import { initCgal } from './getCgal.js';
import { skeletalInsetOfPolygon } from './skeletalInsetOfPolygon.js';
import test from 'ava';

test.beforeEach(async (t) => {
  await initCgal();
});

test('insetOfPolygon/bow', (t) => {
  const polygon = [
    [0.25, -0.18899576365947723, 0],
    [0.7886751294136047, -0.5, 0],
    [0.7886751294136047, 0.5, 0],
    [0.25, 0.18899576365947723, 0],
    [-0.28867512941360474, 0.5, 0],
    [-0.28867512941360474, -0.5, 0],
  ];
  const xyPlane = [0, 0, 1, 0];
  const inset = skeletalInsetOfPolygon(0.1, 0.05, 0.5, xyPlane, polygon, []);
  t.deepEqual(inset, [
    {
      boundary: [
        [0.25, -0.07352570932330914, 0],
        [0.6886751294136046, -0.32679491774838343, 0],
        [0.6886751294136046, 0.32679491774838343, 0],
        [0.25, 0.07352570932330914, 0],
        [-0.18867512941360473, 0.32679491774838343, 0],
        [-0.18867512941360473, -0.32679491774838343, 0],
      ],
      holes: [],
    },
    {
      boundary: [
        [0.25, -0.01579068215522508, 0],
        [0.6386751294136047, -0.24019237662257514, 0],
        [0.6386751294136047, 0.24019237662257514, 0],
        [0.25, 0.01579068215522508, 0],
        [-0.13867512941360471, 0.24019237662257514, 0],
        [-0.13867512941360471, -0.24019237662257514, 0],
      ],
      holes: [],
    },
    {
      boundary: [
        [0.17735026460143843, 0, 0],
        [-0.08867512941360473, 0.15358983549676689, 0],
        [-0.08867512941360473, -0.15358983549676689, 0],
      ],
      holes: [],
    },
    {
      boundary: [
        [0.5886751294136047, -0.15358983549676689, 0],
        [0.5886751294136047, 0.15358983549676689, 0],
        [0.3226497353985615, 0, 0],
      ],
      holes: [],
    },
    {
      boundary: [
        [0.07735026589591157, 0, 0],
        [-0.038675129413604736, 0.06698729437095866, 0],
        [-0.038675129413604736, -0.06698729437095866, 0],
      ],
      holes: [],
    },
    {
      boundary: [
        [0.5386751294136047, -0.06698729437095866, 0],
        [0.5386751294136047, 0.06698729437095866, 0],
        [0.4226497341040884, 0, 0],
      ],
      holes: [],
    },
  ]);
});
