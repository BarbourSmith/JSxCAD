import { initCgal } from './getCgal.js';
import { insetOfPolygonWithHoles } from './insetOfPolygonWithHoles.js';
import test from 'ava';

test.beforeEach(async (t) => {
  await initCgal();
});

test('insetOfPolygon/bow', (t) => {
  const polygon = [
    [0.25, -0.18899576365947723, 0],
    [0.7886751294136047, -0.5, 0],
    [0.7886751294136047, 0.5, 0],
    [0.25, 0.18899576365947723, 0],
    [-0.28867512941360474, 0.5, 0],
    [-0.28867512941360474, -0.5, 0],
  ];
  const xyPlane = [0, 0, 1, 0];
  const inset = insetOfPolygonWithHoles(0.1, 0.05, 0.5, {
    plane: xyPlane,
    points: polygon,
    holes: [],
  });
  t.deepEqual(JSON.parse(JSON.stringify(inset)), [
    {
      points: [
        [0.30555702330196033, 0.10585303876974556, 0],
        [0.2882683432365091, 0.09661204674887136, 0],
        [0.26950903220161293, 0.090921471959677, 0],
        [0.2500000000000001, 0.08900000000000001, 0],
        [0.23049096779838724, 0.09092147195967695, 0],
        [0.21173165676349104, 0.0966120467488713, 0],
        [0.19444297669803978, 0.10585303876974547, 0],
        [-0.1887, 0.3270475176134254, 0],
        [-0.1887, -0.3270475176134255, 0],
        [0.19444297669803978, -0.10585303876974547, 0],
        [0.21173165676349104, -0.09661204674887133, 0],
        [0.23049096779838718, -0.09092147195967697, 0],
        [0.25000000000000006, -0.08900000000000001, 0],
        [0.2695090322016125, -0.09092147195967688, 0],
        [0.28826834323650863, -0.0966120467488712, 0],
        [0.3055570233019599, -0.10585303876974528, 0],
        [0.6886999999999999, -0.3270475176134254, 0],
        [0.6886999999999999, 0.3270475176134255, 0],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [0.33333553495294055, 0.06427955815461833, 0],
        [0.30740251485476366, 0.05041807012330704, 0],
        [0.2792635483024194, 0.04188220793951545, 0],
        [0.2500000000000001, 0.03899999999999998, 0],
        [0.22073645169758083, 0.041882207939515394, 0],
        [0.19259748514523656, 0.05041807012330696, 0],
        [0.16666446504705967, 0.0642795581546182, 0],
        [-0.1387, 0.24057127642013806, 0],
        [-0.1387, -0.24057127642013806, 0],
        [0.16666446504705967, -0.0642795581546182, 0],
        [0.1925974851452365, -0.05041807012330696, 0],
        [0.22073645169758077, -0.04188220793951542, 0],
        [0.25000000000000006, -0.03899999999999998, 0],
        [0.2792635483024186, -0.04188220793951531, 0],
        [0.307402514854763, -0.05041807012330676, 0],
        [0.3333355349529399, -0.06427955815461792, 0],
        [0.6386999999999999, -0.240571276420138, 0],
        [0.6386999999999999, 0.24057127642013806, 0],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.0887, -0.15409503522685075, 0],
        [0.13888595339607956, -0.022706077539490947, 0],
        [0.17346331352698202, -0.004224093497742637, 0],
        [0.1873882836222885, -1.400269634934718e-18, 0],
        [0.1734633135269821, 0.004224093497742609, 0],
        [0.13888595339607956, 0.02270607753949092, 0],
        [-0.0887, 0.15409503522685075, 0],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [0.36111404660392066, 0.022706077539491113, 0],
        [0.32653668647301815, 0.00422409349774272, 0],
        [0.31261171637771146, 1.1286320259481528e-17, 0],
        [0.32653668647301726, -0.004224093497742359, 0],
        [0.3611140466039199, -0.022706077539490558, 0],
        [0.5887, -0.1540950352268507, 0],
        [0.5887, 0.1540950352268508, 0],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.03870000000000001, -0.0676187940335635, 0],
        [0.07842618760733325, -1.387778780781446e-17, 0],
        [-0.03870000000000001, 0.06761879403356347, 0],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [0.4215738123926668, 5.050566734215748e-17, 0],
        [0.5387, -0.06761879403356338, 0],
        [0.5387, 0.0676187940335635, 0],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
  ]);
});
