import { initCgal } from './getCgal.js';
import { insetOfPolygonWithHoles } from './insetOfPolygonWithHoles.js';
import test from 'ava';

test.beforeEach(async (t) => {
  await initCgal();
});

test('insetOfPolygonWithHoles/bow', (t) => {
  const polygon = [
    [0.25, -0.18899576365947723, 0],
    [0.7886751294136047, -0.5, 0],
    [0.7886751294136047, 0.5, 0],
    [0.25, 0.18899576365947723, 0],
    [-0.28867512941360474, 0.5, 0],
    [-0.28867512941360474, -0.5, 0],
  ];
  const xyPlane = [0, 0, 1, 0];
  const inset = insetOfPolygonWithHoles(0.1, 0.05, 0.5, {
    plane: xyPlane,
    points: polygon,
    holes: [],
  });
  t.deepEqual(JSON.parse(JSON.stringify(inset)), [
    {
      points: [
        [0.30555702330196033, 0.10584880242922279, 0],
        [0.2882683432365091, 0.0966078104083486, 0],
        [0.2695090322016129, 0.09091723561915421, 0],
        [0.25000000000000006, 0.08899576365947723, 0],
        [0.2304909677983872, 0.09091723561915417, 0],
        [0.21173165676349104, 0.09660781040834854, 0],
        [0.19444297669803978, 0.10584880242922269, 0],
        [-0.18867512941360473, 0.32704214794191805, 0],
        [-0.18867512941360473, -0.32704214794191805, 0],
        [0.19444297669803978, -0.1058488024292227, 0],
        [0.211731656763491, -0.09660781040834855, 0],
        [0.23049096779838715, -0.09091723561915419, 0],
        [0.25, -0.08899576365947723, 0],
        [0.26950903220161243, -0.0909172356191541, 0],
        [0.28826834323650863, -0.09660781040834841, 0],
        [0.3055570233019599, -0.10584880242922251, 0],
        [0.6886751294136046, -0.32704214794191805, 0],
        [0.6886751294136046, 0.32704214794191805, 0],
      ],
      exactPoints: [
        [
          '2752212992566293/9007199254740992',
          '476700627177861/4503599627370496',
          '0',
        ],
        [
          '2596490406365305/9007199254740992',
          '1740331595824473/18014398509481984',
          '0',
        ],
        [
          '4855043107984667/18014398509481984',
          '818909656911957/9007199254740992',
          '0',
        ],
        [
          '4503599627370497/18014398509481984',
          '3206410304434995/36028797018963968',
          '0',
        ],
        [
          '8304312293512653/36028797018963968',
          '6551277255295653/72057594037927936',
          '0',
        ],
        [
          '238388652625649/1125899906842624',
          '217541449478059/2251799813685248',
          '0',
        ],
        [
          '437846658701051/2251799813685248',
          '7627210034845769/72057594037927936',
          '0',
        ],
        [
          '-6797737940169523/36028797018963968',
          '5891467582422675/18014398509481984',
          '0',
        ],
        [
          '-6797737940169523/36028797018963968',
          '-5891467582422675/18014398509481984',
          '0',
        ],
        [
          '437846658701051/2251799813685248',
          '-3813605017422885/36028797018963968',
          '0',
        ],
        [
          '7628436884020767/36028797018963968',
          '-6961326383297889/72057594037927936',
          '0',
        ],
        [
          '8304312293512651/36028797018963968',
          '-3275638627647827/36028797018963968',
          '0',
        ],
        ['1/4', '-3206410304434995/36028797018963968', '0'],
        [
          '4855043107984659/18014398509481984',
          '-204727414227989/2251799813685248',
          '0',
        ],
        [
          '2596490406365301/9007199254740992',
          '-6961326383297879/72057594037927936',
          '0',
        ],
        [
          '2752212992566289/9007199254740992',
          '-1906802508711439/18014398509481984',
          '0',
        ],
        [
          '1550758528103219/2251799813685248',
          '-5891467582422675/18014398509481984',
          '0',
        ],
        [
          '1550758528103219/2251799813685248',
          '5891467582422675/18014398509481984',
          '0',
        ],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [0.3333355349529405, 0.06427532181409555, 0],
        [0.3074025148547636, 0.05041383378278427, 0],
        [0.27926354830241934, 0.041877971598992675, 0],
        [0.2500000000000001, 0.03899576365947721, 0],
        [0.22073645169758083, 0.04187797159899262, 0],
        [0.19259748514523656, 0.05041383378278419, 0],
        [0.16666446504705965, 0.06427532181409541, 0],
        [-0.13867512941360471, 0.24056322191287707, 0],
        [-0.13867512941360471, -0.24056322191287707, 0],
        [0.16666446504705965, -0.06427532181409543, 0],
        [0.1925974851452365, -0.05041383378278419, 0],
        [0.22073645169758074, -0.04187797159899265, 0],
        [0.25, -0.03899576365947721, 0],
        [0.2792635483024186, -0.041877971598992536, 0],
        [0.30740251485476294, -0.050413833782783996, 0],
        [0.3333355349529399, -0.06427532181409513, 0],
        [0.6386751294136047, -0.24056322191287705, 0],
        [0.6386751294136047, 0.2405632219128771, 0],
      ],
      exactPoints: [
        [
          '6004839164013631/18014398509481984',
          '4631525045937271/72057594037927936',
          '0',
        ],
        [
          '5537671405410667/18014398509481984',
          '1816349784307723/36028797018963968',
          '0',
        ],
        [
          '5030764848291753/18014398509481984',
          '1508812938306045/36028797018963968',
          '0',
        ],
        [
          '2251799813685249/9007199254740992',
          '351242613371699/9007199254740992',
          '0',
        ],
        [
          '1988217203224621/9007199254740992',
          '1508812938306043/36028797018963968',
          '0',
        ],
        [
          '433690981166291/2251799813685248',
          '227043723038465/4503599627370496',
          '0',
        ],
        [
          '6004720181454727/36028797018963968',
          '4631525045937261/72057594037927936',
          '0',
        ],
        [
          '-1249074522305331/9007199254740992',
          '8667203492527033/36028797018963968',
          '0',
        ],
        [
          '-1249074522305331/9007199254740992',
          '-8667203492527033/36028797018963968',
          '0',
        ],
        [
          '6004720181454727/36028797018963968',
          '-2315762522968631/36028797018963968',
          '0',
        ],
        [
          '3469527849330327/18014398509481984',
          '-227043723038465/4503599627370496',
          '0',
        ],
        [
          '7952868812898481/36028797018963968',
          '-377203234576511/9007199254740992',
          '0',
        ],
        ['1/4', '-351242613371699/9007199254740992', '0'],
        [
          '1257691212072935/4503599627370496',
          '-188601617288255/4503599627370496',
          '0',
        ],
        [
          '5537671405410655/18014398509481984',
          '-1816349784307713/36028797018963968',
          '0',
        ],
        [
          '1501209791003405/4503599627370496',
          '-4631525045937241/72057594037927936',
          '0',
        ],
        [
          '5752674149675827/9007199254740992',
          '-1083400436565879/4503599627370496',
          '0',
        ],
        [
          '5752674149675827/9007199254740992',
          '4333601746263517/18014398509481984',
          '0',
        ],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.08867512941360473, -0.15408429588383615, 0],
        [0.13888595339607956, -0.022701841198968176, 0],
        [0.17346331352698202, -0.0042198571572198695, 0],
        [0.18737431827916232, -1.402228363414513e-18, 0],
        [0.1734633135269821, 0.004219857157219842, 0],
        [0.13888595339607956, 0.022701841198968148, 0],
        [-0.08867512941360473, 0.15408429588383613, 0],
      ],
      exactPoints: [
        [
          '-1597429119136563/18014398509481984',
          '-2775735910104359/18014398509481984',
          '0',
        ],
        [
          '156371681990395/1125899906842624',
          '-408960014257189/18014398509481984',
          '0',
        ],
        [
          '3124837256650271/18014398509481984',
          '-152036376966497/36028797018963968',
          '0',
        ],
        [
          '6750871279846689/36028797018963968',
          '-910098240788201/649037107316853453566312041152512',
          '0',
        ],
        [
          '6249674513300545/36028797018963968',
          '4751136780203/1125899906842624',
          '0',
        ],
        [
          '156371681990395/1125899906842624',
          '817920028514377/36028797018963968',
          '0',
        ],
        [
          '-1597429119136563/18014398509481984',
          '5551471820208717/36028797018963968',
          '0',
        ],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [0.36111404660392066, 0.022701841198968342, 0],
        [0.32653668647301815, 0.004219857157219953, 0],
        [0.31262568172083766, 1.131449898345388e-17, 0],
        [0.32653668647301726, -0.004219857157219592, 0],
        [0.3611140466039198, -0.022701841198967787, 0],
        [0.5886751294136047, -0.1540842958838361, 0],
        [0.5886751294136047, 0.15408429588383618, 0],
      ],
      exactPoints: [
        [
          '1626313085723669/4503599627370496',
          '51120001782149/2251799813685248',
          '0',
        ],
        [
          '1470590499522681/4503599627370496',
          '38009094241625/9007199254740992',
          '0',
        ],
        [
          '5631763614817647/18014398509481984',
          '7343529690960385/649037107316853453566312041152512',
          '0',
        ],
        [
          '1470590499522677/4503599627370496',
          '-152036376966487/36028797018963968',
          '0',
        ],
        [
          '6505252342894661/18014398509481984',
          '-204480007128591/9007199254740992',
          '0',
        ],
        [
          '5302314186938777/9007199254740992',
          '-1387867955052179/9007199254740992',
          '0',
        ],
        [
          '5302314186938777/9007199254740992',
          '5551471820208719/36028797018963968',
          '0',
        ],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.038675129413604736, -0.06760536985479522, 0],
        [0.0784208040183521, -1.3877787807814457e-17, 0],
        [-0.038675129413604736, 0.06760536985479519, 0],
      ],
      exactPoints: [
        ['-648861/16777216', '-4871480295780805/72057594037927936', '0'],
        ['5650814460082323/72057594037927936', '-1/72057594037927936', '0'],
        ['-648861/16777216', '4871480295780803/72057594037927936', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [0.4215791959816479, 5.048794259449142e-17, 0],
        [0.5386751294136047, -0.06760536985479514, 0],
        [0.5386751294136047, 0.06760536985479525, 0],
      ],
      exactPoints: [
        [
          '7594495639720411/18014398509481984',
          '1024017131747127/20282409603651670423947251286016',
          '0',
        ],
        ['9037469/16777216', '-4871480295780799/72057594037927936', '0'],
        ['9037469/16777216', '4871480295780807/72057594037927936', '0'],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
  ]);
});
