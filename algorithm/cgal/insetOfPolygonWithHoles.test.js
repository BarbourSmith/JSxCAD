import { initCgal } from './getCgal.js';
import { insetOfPolygonWithHoles } from './insetOfPolygonWithHoles.js';
import test from 'ava';

test.beforeEach(async (t) => {
  await initCgal();
});

test('insetOfPolygonWithHoles/bow', (t) => {
  const polygon = [
    [0.25, -0.18899576365947723, 0],
    [0.7886751294136047, -0.5, 0],
    [0.7886751294136047, 0.5, 0],
    [0.25, 0.18899576365947723, 0],
    [-0.28867512941360474, 0.5, 0],
    [-0.28867512941360474, -0.5, 0],
  ];
  const xyPlane = [0, 0, 1, 0];
  const inset = insetOfPolygonWithHoles(0.1, 0.05, 0.5, {
    plane: xyPlane,
    points: polygon,
    holes: [],
  });
  t.deepEqual(JSON.parse(JSON.stringify(inset)), [
    {
      points: [
        [0.30555702330196033, 0.10585303876974556, 0],
        [0.2882683432365091, 0.09661204674887136, 0],
        [0.2695090322016129, 0.09092147195967698, 0],
        [0.25000000000000006, 0.089, 0],
        [0.2304909677983872, 0.09092147195967694, 0],
        [0.21173165676349104, 0.0966120467488713, 0],
        [0.19444297669803978, 0.10585303876974546, 0],
        [-0.1887, 0.3270475176134253, 0],
        [-0.1887, -0.3270475176134254, 0],
        [0.19444297669803978, -0.10585303876974547, 0],
        [0.211731656763491, -0.09661204674887132, 0],
        [0.23049096779838715, -0.09092147195967695, 0],
        [0.25, -0.089, 0],
        [0.26950903220161243, -0.09092147195967687, 0],
        [0.28826834323650863, -0.09661204674887118, 0],
        [0.3055570233019599, -0.10585303876974528, 0],
        [0.6886999999999999, -0.3270475176134253, 0],
        [0.6886999999999999, 0.3270475176134254, 0],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [0.3333355349529405, 0.06427955815461832, 0],
        [0.3074025148547636, 0.05041807012330704, 0],
        [0.27926354830241934, 0.04188220793951544, 0],
        [0.2500000000000001, 0.03899999999999998, 0],
        [0.22073645169758083, 0.04188220793951539, 0],
        [0.19259748514523656, 0.05041807012330696, 0],
        [0.16666446504705965, 0.06427955815461818, 0],
        [-0.1387, 0.24057127642013804, 0],
        [-0.1387, -0.24057127642013804, 0],
        [0.16666446504705965, -0.0642795581546182, 0],
        [0.1925974851452365, -0.05041807012330696, 0],
        [0.22073645169758074, -0.041882207939515415, 0],
        [0.25, -0.03899999999999998, 0],
        [0.2792635483024186, -0.041882207939515304, 0],
        [0.30740251485476294, -0.05041807012330676, 0],
        [0.3333355349529399, -0.0642795581546179, 0],
        [0.6386999999999999, -0.24057127642013798, 0],
        [0.6386999999999999, 0.24057127642013804, 0],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.0887, -0.15409503522685075, 0],
        [0.13888595339607956, -0.022706077539490943, 0],
        [0.17346331352698202, -0.004224093497742637, 0],
        [0.1873882836222885, -1.400269634934718e-18, 0],
        [0.1734633135269821, 0.004224093497742609, 0],
        [0.13888595339607956, 0.022706077539490915, 0],
        [-0.0887, 0.15409503522685072, 0],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [0.36111404660392066, 0.02270607753949111, 0],
        [0.32653668647301815, 0.00422409349774272, 0],
        [0.31261171637771146, 1.1286320259481528e-17, 0],
        [0.32653668647301726, -0.004224093497742359, 0],
        [0.3611140466039198, -0.022706077539490555, 0],
        [0.5886999999999999, -0.1540950352268507, 0],
        [0.5886999999999999, 0.15409503522685078, 0],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [-0.03870000000000001, -0.06761879403356348, 0],
        [0.07842618760733325, -1.3877787807814457e-17, 0],
        [-0.03870000000000001, 0.06761879403356345, 0],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
    {
      points: [
        [0.4215738123926667, 5.050566734215747e-17, 0],
        [0.5387, -0.06761879403356338, 0],
        [0.5387, 0.06761879403356348, 0],
      ],
      holes: [],
      plane: [0, 0, 1, 0],
    },
  ]);
});
