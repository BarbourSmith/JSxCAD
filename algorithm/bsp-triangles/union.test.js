import { toGeneric, transform } from '@jsxcad/algorithm-polygons';

import { fromTranslation } from '@jsxcad/math-mat4';
import { test } from 'ava';
import { union } from './union';

const cubePolygons = [[[-1, -1, -1], [-1, -1, 1], [-1, 1, 1], [-1, 1, -1]],
                      [[1, -1, -1], [1, 1, -1], [1, 1, 1], [1, -1, 1]],
                      [[-1, -1, -1], [1, -1, -1], [1, -1, 1], [-1, -1, 1]],
                      [[-1, 1, -1], [-1, 1, 1], [1, 1, 1], [1, 1, -1]],
                      [[-1, -1, -1], [-1, 1, -1], [1, 1, -1], [1, -1, -1]],
                      [[-1, -1, 1], [1, -1, 1], [1, 1, 1], [-1, 1, 1]]];

test('Self union', t => {
  const unioned = union(cubePolygons, cubePolygons);
  t.deepEqual(toGeneric(unioned), cubePolygons);
});

test('Overlapping union', t => {
  const unioned = toGeneric(union(transform(fromTranslation([0.5, 0.5, 0.5]), cubePolygons),
                                  cubePolygons));
  t.deepEqual(unioned,
              [[[-0.5, 1.5, -0.5], [-0.5, 1, -0.5], [-0.5, 1.5, 1.5]], [[-0.5, 1, 1.5], [-0.5, 1.5, 1.5], [-0.5, 1, -0.5]], [[-0.5, 1, 1.5], [-0.5, 1, 1], [-0.5, 0.625, 1]], [[-0.5, -0.5, 1], [-0.5, -0.5, 1.5], [-0.5, 0.625, 1]], [[-0.5, 1, 1.5], [-0.5, 0.625, 1], [-0.5, -0.5, 1.5]], [[-1, -1, -1], [-1, -1, 1], [-1, 1, 1], [-1, 1, -1]], [[-1, -1, 1], [-1, -1, -1], [-0.5, -1, 1]], [[-0.5, -1, -1], [-0.5, -1, 1], [-1, -1, -1]], [[-0.5, 1, -1], [-1, 1, -1], [-0.5, 1, 1]], [[-1, 1, 1], [-0.5, 1, 1], [-1, 1, -1]], [[-0.5, -1, -1], [-1, -1, -1], [-0.5, 1, -1]], [[-1, 1, -1], [-0.5, 1, -1], [-1, -1, -1]], [[-1, 1, 1], [-1, -1, 1], [-0.5, 1, 1]], [[-0.5, -1, 1], [-0.5, 1, 1], [-1, -1, 1]], [[1.5, -0.5, -0.5], [1.5, 1.5, -0.5], [1.5, 1.5, 1.5], [1.5, -0.5, 1.5]], [[1, -0.5, -0.5], [1.5, -0.5, -0.5], [1, -0.5, 1.5]], [[1.5, -0.5, 1.5], [1, -0.5, 1.5], [1.5, -0.5, -0.5]], [[1, -0.5, 1.5], [-0.5, -0.5, 1.5], [0.625, -0.5, 1]], [[-0.5, -0.5, 1], [0.625, -0.5, 1], [-0.5, -0.5, 1.5]], [[1, -0.5, 1], [1, -0.5, 1.5], [0.625, -0.5, 1]], [[1, -1, 1], [1, -1, -1], [1, -0.5, 1]], [[1, -0.5, -1], [1, -0.5, 1], [1, -1, -1]], [[-0.5, -1, -1], [1, -1, -1], [-0.5, -1, 1]], [[1, -1, 1], [-0.5, -1, 1], [1, -1, -1]], [[1, -0.5, -1], [1, -1, -1], [-0.125, -0.5, -1]], [[-0.5, -1, -1], [-0.125, -0.5, -1], [1, -1, -1]], [[-0.5, -1, -1], [-0.5, -0.5, -1], [-0.125, -0.5, -1]], [[-0.5, -0.5, 1], [-0.5, -1, 1], [0.625, -0.5, 1]], [[1, -1, 1], [0.625, -0.5, 1], [-0.5, -1, 1]], [[1, -1, 1], [1, -0.5, 1], [0.625, -0.5, 1]], [[1.5, 1.5, -0.5], [1, 1.5, -0.5], [1.5, 1.5, 1.5]], [[1, 1.5, 1.5], [1.5, 1.5, 1.5], [1, 1.5, -0.5]], [[1, 1.5, -0.5], [-0.5, 1.5, -0.5], [1, 1.5, 1.5]], [[-0.5, 1.5, 1.5], [1, 1.5, 1.5], [-0.5, 1.5, -0.5]], [[1.5, -0.5, -0.5], [1, -0.5, -0.5], [1.5, 1.5, -0.5]], [[1, 1.5, -0.5], [1.5, 1.5, -0.5], [1, -0.5, -0.5]], [[1, 1.5, -0.5], [1, 1, -0.5], [0.625, 1, -0.5]], [[-0.5, 1, -0.5], [-0.5, 1.5, -0.5], [0.625, 1, -0.5]], [[1, 1.5, -0.5], [0.625, 1, -0.5], [-0.5, 1.5, -0.5]], [[1, -0.5, -0.5], [1, -0.5, -1], [1, 0.625, -0.5]], [[1, 1, -1], [1, 0.625, -0.5], [1, -0.5, -1]], [[1, 1, -1], [1, 1, -0.5], [1, 0.625, -0.5]], [[1, 1, -0.5], [1, 1, -1], [-0.125, 1, -0.5]], [[-0.5, 1, -1], [-0.125, 1, -0.5], [1, 1, -1]], [[-0.5, 1, -1], [-0.5, 1, -0.5], [-0.125, 1, -0.5]], [[1, 1, -1], [1, -0.5, -1], [-0.125, -0.5, -1]], [[-0.5, -0.5, -1], [-0.5, 1, -1], [-0.125, -0.5, -1]], [[1, 1, -1], [-0.125, -0.5, -1], [-0.5, 1, -1]], [[1, -0.5, 1.5], [1.5, -0.5, 1.5], [1, 1.5, 1.5]], [[1.5, 1.5, 1.5], [1, 1.5, 1.5], [1.5, -0.5, 1.5]], [[1, 1.5, 1.5], [-0.5, 1.5, 1.5], [0.625, 1, 1.5]], [[-0.5, 1, 1.5], [0.625, 1, 1.5], [-0.5, 1.5, 1.5]], [[1, 1, 1.5], [1, 1.5, 1.5], [0.625, 1, 1.5]], [[-0.5, 1, 1.5], [-0.5, -0.5, 1.5], [0.625, 1, 1.5]], [[-0.5, -0.5, 1.5], [1, -0.5, 1.5], [0.625, 1, 1.5]], [[1, 1, 1.5], [0.625, 1, 1.5], [1, -0.5, 1.5]]]);
});
